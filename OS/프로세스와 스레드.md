# 프로세스와 스레드

## 프로세스와 스레드의 정의

- 프로세스 : 운영체제로부터 자원을 할당받은 <b>작업<b>의 단위.
- 스레드 : 프로세스가 할당받은 자원을 이용하는 <b>실행 흐름<b>의 단위.

### (1) 프로세스

- 쉽~게 이해해보면, 프로그램을 실행하는 순간, 파일은 메모리에 올라가고, 이 상태의 프로그램을 프로세스라고 한다.
- 프로세스가 메모리에 올라갈 때 운영체제로부터 시스템 자원을 할당받는다.
    > Code/Data/Stack/Heap 메모리 영역
- 프로세스는 아래와 같은 상태들이 있다.
    > new : 프로세스가 생성 중.
    > running : 명령어들이 실행 중.
    > waiting : 프로세스가 어떤 일이 일어나기를 기다리고 있다.
    > ready : 프로세스가 처리기에 할당되기를 기다린다.
    > terminated : 프로세스의 실행이 종료되었다.

#### 프로세스 제어 블록(Process Control Block, PCB)

- 특정 프로세스에 대한 중요한 정보를 저장하고 있는 자료구조이다. 
- 운영체제는 프로세스를 관리하기 위해 프로세스의 생성과 동시에 고유한 PCB를 생성한다.
- 아래 다음과 같은 것들을 포함한다.
    > 프로세스 식별자(Process ID, PID) : 프로세스 식별 번호
    > 프로세스 상태 : new, running, waiting, ready, terminated 등의 상태를 저장.
    > 프로그램 카운터 : 이 프로세스가 다음에 실행할 명령어의 주소를 가리킴.
    > CPU 레지스터들 : 프로그램 카운터와 함께 이 상태 정보는 나중에 프로세스가 계속 올바르게 실행되도록 인터럽트 발생 시 저장되어야 함.
    > CPU 스케쥴링 정보 : 프로세스 우선순위, 스케쥴 큐에 대한 포인터와 다른 스케쥴 매개변수들을 포함.
    > 메모리 관리 정보 : 페이지 테이블 또는 세그먼트 테이블 등과 같은 정보.
    > accounting 정보 : CPU 사용 시간, 경과된 시간, 시간 제한, 프로세스 번호 등
    > 입출력 상태 정보

### (2) 스레드
- 프로세스의 코드에 정의된 절차에 따라 실행되는 특정한 수행 경로.
- <b>CPU 이용의 기본 단위<b>. 프로세스의 실행 단위라고도 할 수 있다.
- <b>스레드는 프로세스와 다르게 스레드 간 메모리를 공유하며 작동한다<b>.
- 프로세스가 할당받은 메모리 영역 내에서 Stack 형식으로 할당된 메모리 영역은 따로 할당받고, 나머지 Code/Data/Heap 형식으로 할당된 메모리 영역은 공유한다. 따라서, 각각의 스레드는 별도의 Stack을 가지고 있지만, Heap 메모리는 서로 읽고 쓸 수 있게 된다.
    > Stack, PC Register를 따로 할당받는 이유
        >> Stack : 함수 호출 시 전달되는 인자, 되돌아갈 주소값 및 함수 내에서 선언하는 변수 등을 저장하기 위해 사용되는 메모리 공간이므로, Stack 메모리 공간이 독립적이라는 것은 독립적인 함수 호출이 가능하다는 것이며, 이는 독립적인 실행 흐름이 추가되는 것이다. 따라서, 독립적인 실행흐름을 추가하기 위한 최소 조건으로 독립된 Stack을 할당받는다.
        >> PC Register : PC값은 스레드가 명령어의 어디까지를 수행하였는지 나타낸다. 스레드는 CPU를 할당받았다가 스케쥴러에 의해 다시 선점당하는데, 그렇기 때문에 명령어가 연속적으로 수행되지 못하고 어느 부분 까지 수행했는가 기억할 필요가 있다.

## etc

- 만약 한 프로세스를 실행하다가 오류가 발생해서 프로세스가 강제로 종료된다면?
    > 프로세스 : 공유하고 있는 파일을 손상시키는 경우가 아니라면 영향 X
    > 스레드 : Code/Data/Heap 메모리 영역의 내용을 공유하기 때문에, 어떤 스레드 하나에서 오류가 발생한다면 같은 프로세스 내의 다른 스레드 모두가 강제로 종료된다.
